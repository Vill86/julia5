<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ –ò–≥—Ä–∞ –¥–ª—è –ù–∞—Å—Ç–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .level-info {
            text-align: center;
            font-size: 20px;
            color: #764ba2;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .info-item {
            background: #f5f5f5;
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        .errors {
            color: #F44336;
            font-weight: bold;
        }

        .timer {
            background: #FF9800;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .timer.warning {
            background: #F44336;
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .task-container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            min-height: 300px;
        }

        .task-title {
            font-size: 22px;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            background: white;
            border: 3px solid #667eea;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
        }

        .option-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .option-btn:active {
            transform: scale(0.95);
        }

        .option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .math-input, .word-input {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            border: 3px solid #667eea;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
        }

        .submit-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #45a049;
            transform: scale(1.1);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: scale(1);
        }

        .feedback {
            text-align: center;
            font-size: 24px;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            animation: fadeIn 0.5s;
        }

        .feedback.correct {
            background: #C8E6C9;
            color: #2E7D32;
        }

        .feedback.incorrect {
            background: #FFCDD2;
            color: #C62828;
        }

        .final-screen {
            text-align: center;
            padding: 30px;
        }

        .final-screen h2 {
            font-size: 32px;
            margin: 20px 0;
            color: #764ba2;
        }

        .final-screen p {
            font-size: 24px;
            line-height: 1.6;
            color: #333;
        }

        .emoji {
            font-size: 80px;
            margin: 20px 0;
        }

        .score {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 28px;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 20px auto;
        }

        .memory-card {
            aspect-ratio: 1;
            background: #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .memory-card.flipped {
            background: white;
            border: 3px solid #667eea;
        }

        .memory-card.matched {
            background: #4CAF50;
            border: 3px solid #2E7D32;
        }

        .color-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .color-btn {
            padding: 30px;
            border-radius: 15px;
            border: none;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .drawing-canvas {
            border: 3px solid #667eea;
            border-radius: 10px;
            cursor: crosshair;
            display: block;
            margin: 20px auto;
            touch-action: none;
            max-width: 100%;
        }

        .color-palette {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .color-choice {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid #333;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-choice.active {
            transform: scale(1.2);
            border-width: 5px;
        }

        .slider-container {
            margin: 30px 0;
        }

        .slider {
            width: 100%;
            height: 15px;
            border-radius: 10px;
            outline: none;
            -webkit-appearance: none;
            background: #ddd;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        .sorting-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .sort-item {
            background: white;
            padding: 15px;
            border: 3px solid #667eea;
            border-radius: 10px;
            cursor: move;
            font-size: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .sort-item.dragging {
            opacity: 0.5;
        }

        .sort-item:hover {
            background: #f0f0f0;
            transform: scale(1.02);
        }

        .shape-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px auto;
            max-width: 400px;
        }

        .shape-item {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .shape-item:hover {
            background: #f0f0f0;
            transform: scale(1.1);
        }

        .shape-item.selected {
            border-color: #4CAF50;
            background: #C8E6C9;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 480px) {
            h1 { font-size: 24px; }
            .task-title { font-size: 18px; }
            .option-btn { font-size: 16px; padding: 12px; }
            .memory-grid { grid-template-columns: repeat(4, 1fr); gap: 5px; }
            .memory-card { font-size: 24px; }
            .info-item { font-size: 16px; padding: 8px 15px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üéÆ –ò–≥—Ä–∞ –¥–ª—è –ù–∞—Å—Ç–∏ üåü</h1>
        <div class="progress-bar">
            <div class="progress-fill" id="progress">
                <span id="progress-text">–£—Ä–æ–≤–µ–Ω—å 1 –∏–∑ 13</span>
            </div>
        </div>
        <div class="level-info" id="level-info">
            <div class="info-item">–ë–∞–ª–ª—ã: <span id="score">0</span> / 130</div>
            <div class="info-item errors">–û—à–∏–±–∫–∏: <span id="errors">0</span> / 3</div>
        </div>
        <div class="task-container" id="task-container">
            <!-- –ó–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>
    </div>

    <script>
        let currentLevel = 1;
        let totalScore = 0;
        let errorCount = 0;
        const maxLevels = 13;
        const pointsPerLevel = 10;
        const maxScore = maxLevels * pointsPerLevel;
        const maxErrors = 3;
        let timerInterval = null;
        let currentTimer = 0;

        const levels = [
            // –£—Ä–æ–≤–µ–Ω—å 1: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞
            {
                type: 'math',
                question: 'üî¢ –†–µ—à–∏ –ø—Ä–∏–º–µ—Ä: 15 + 23 = ?',
                answer: 38
            },
            // –£—Ä–æ–≤–µ–Ω—å 2: –í–∏–∫—Ç–æ—Ä–∏–Ω–∞
            {
                type: 'quiz',
                question: 'üåç –ö–∞–∫–∞—è –ø–ª–∞–Ω–µ—Ç–∞ —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è –≤ –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ?',
                options: ['–ó–µ–º–ª—è', '–Æ–ø–∏—Ç–µ—Ä', '–ú–∞—Ä—Å', '–í–µ–Ω–µ—Ä–∞'],
                answer: 1
            },
            // –£—Ä–æ–≤–µ–Ω—å 3: –¶–≤–µ—Ç–∞
            {
                type: 'colors',
                question: 'üé® –ö–∞–∫–æ–π —Ü–≤–µ—Ç –ø–æ–ª—É—á–∏—Ç—Å—è, –µ—Å–ª–∏ —Å–º–µ—à–∞—Ç—å —Å–∏–Ω–∏–π –∏ –∂–µ–ª—Ç—ã–π?',
                options: [
                    {text: '–ó–µ–ª—ë–Ω—ã–π', color: '#4CAF50'},
                    {text: '–ö—Ä–∞—Å–Ω—ã–π', color: '#F44336'},
                    {text: '–û—Ä–∞–Ω–∂–µ–≤—ã–π', color: '#FF9800'},
                    {text: '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π', color: '#9C27B0'}
                ],
                answer: 0
            },
            // –£—Ä–æ–≤–µ–Ω—å 4: –ü–∞–º—è—Ç—å –° –¢–ê–ô–ú–ï–†–û–ú 40 —Å–µ–∫—É–Ω–¥
            {
                type: 'memory',
                question: 'üß† –ù–∞–π–¥–∏ –≤—Å–µ –ø–∞—Ä—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–º–æ–¥–∑–∏ –∑–∞ 40 —Å–µ–∫—É–Ω–¥!',
                emojis: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'ü¶ä', 'üêª', 'üêº', 'üê®'],
                timeLimit: 40
            },
            // –£—Ä–æ–≤–µ–Ω—å 5: –°–ª–æ–≤–∞
            {
                type: 'word',
                question: 'üìù –ù–∞–ø–∏—à–∏ —Å–ª–æ–≤–æ "—Ä–∞–¥—É–≥–∞" –Ω–∞–æ–±–æ—Ä–æ—Ç',
                answer: '–∞–≥—É–¥–∞—Ä'
            },
            // –£—Ä–æ–≤–µ–Ω—å 6: –ó–∞–≥–∞–¥–∫–∞
            {
                type: 'riddle',
                question: 'ü§î –ó–∞–≥–∞–¥–∫–∞: –ó–∏–º–æ–π –∏ –ª–µ—Ç–æ–º –æ–¥–Ω–∏–º —Ü–≤–µ—Ç–æ–º. –ß—Ç–æ —ç—Ç–æ?',
                options: ['–Å–ª–∫–∞', '–°–Ω–µ–≥', '–¢—Ä–∞–≤–∞', '–ù–µ–±–æ'],
                answer: 0
            },
            // –£—Ä–æ–≤–µ–Ω—å 7: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –ø–æ—Å–ª–æ–∂–Ω–µ–µ
            {
                type: 'math',
                question: 'üî¢ –†–µ—à–∏ –ø—Ä–∏–º–µ—Ä: 7 √ó 8 = ?',
                answer: 56
            },
            // –£—Ä–æ–≤–µ–Ω—å 8: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            {
                type: 'sequence',
                question: 'üî¢ –ö–∞–∫–æ–µ —á–∏—Å–ª–æ —Å–ª–µ–¥—É—é—â–µ–µ? 2, 4, 6, 8, ?',
                answer: 10
            },
            // –£—Ä–æ–≤–µ–Ω—å 9: –†–∏—Å–æ–≤–∞–Ω–∏–µ
            {
                type: 'drawing',
                question: 'üé® –ù–∞—Ä–∏—Å—É–π —Å–æ–ª–Ω—ã—à–∫–æ! (–ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—à—å, –Ω–∞–∂–º–∏ "–ì–æ—Ç–æ–≤–æ")'
            },
            // –£—Ä–æ–≤–µ–Ω—å 10: –í–∏–∫—Ç–æ—Ä–∏–Ω–∞
            {
                type: 'quiz',
                question–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª–µ?',
                options: ['5', '6', '7', '8'],
                answer: 2
            },
            // –ù–û–í–´–ô –£—Ä–æ–≤–µ–Ω—å 11: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —á–∏—Å–µ–ª
            {
                type: 'sorting',
                question: 'üî¢ –†–∞—Å—Å—Ç–∞–≤—å —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É (–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π –º—ã—à–∫–æ–π –∏–ª–∏ –ø–∞–ª—å—Ü–µ–º)',
                items: ['5', '1', '9', '3', '7'],
                correctOrder: ['1', '3', '5', '7', '9']
            },
            // –ù–û–í–´–ô –£—Ä–æ–≤–µ–Ω—å 12: –£–≥–∞–¥–∞–π —Ñ–æ—Ä–º—É
            {
                type: 'shapes',
                question: 'üî∑ –ù–∞–π–¥–∏ –≤—Å–µ –ö–í–ê–î–†–ê–¢–´ (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)',
                shapes: [
                    {emoji: '‚¨õ', isSquare: true},
                    {emoji: 'üî¥', isSquare: false},
                    {emoji: 'üü¶', isSquare: true},
                    {emoji: 'üî∫', isSquare: false},
                    {emoji: 'üü™', isSquare: true},
                    {emoji: 'üîµ', isSquare: false}
                ]
            },
            // –ù–û–í–´–ô –£—Ä–æ–≤–µ–Ω—å 13: –°–ª–∞–π–¥–µ—Ä
            {
                type: 'slider',
                question: 'üéöÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏ —á–∏—Å–ª–æ —Ä–æ–≤–Ω–æ –Ω–∞ 75!',
                targetValue: 75
            }
        ];

        function updateProgress() {
            const progress = (currentLevel / maxLevels) * 100;
            document.getElementById('progress').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `–£—Ä–æ–≤–µ–Ω—å ${currentLevel} –∏–∑ ${maxLevels}`;
            document.getElementById('score').textContent = totalScore;
            document.getElementById('errors').textContent = errorCount;
        }

        function showFeedback(isCorrect) {
            const feedback = document.createElement('div');
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.textContent = isCorrect ? 'üéâ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ú–æ–ª–æ–¥–µ—Ü! üéâ' : 'üí™ –û—à–∏–±–∫–∞! –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑! üí™';
            
            const container = document.getElementById('task-container');
            container.insertBefore(feedback, container.firstChild);
            
            setTimeout(() => {
                feedback.remove();
            }, 2000);
        }

        function checkGameOver() {
            if (errorCount >= maxErrors) {
                clearInterval(timerInterval);
                showGameOverScreen();
                return true;
            }
            return false;
        }

        function showGameOverScreen() {
            const container = document.getElementById('task-container');
            container.innerHTML = '';

            const finalDiv = document.createElement('div');
            finalDiv.className = 'final-screen';

            const emoji = document.createElement('div');
            emoji.className = 'emoji';
            emoji.textContent = 'üò¢üí™';

            const title = document.createElement('h2');
            title.textContent = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞';

            const message = document.createElement('p');
            message.innerHTML = `
                –¢—ã –¥–æ–ø—É—Å—Ç–∏–ª–∞ 3 –æ—à–∏–±–∫–∏ üòî<br><br>
                <strong>–ù–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Å—è!</strong><br>
                –£ —Ç–µ–±—è –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è! üåà<br><br>
                –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑! üí™
            `;

            const scoreDiv = document.createElement('div');
            scoreDiv.className = 'score';
            scoreDiv.textContent = `–¢—ã –Ω–∞–±—Ä–∞–ª–∞: ${totalScore} –±–∞–ª–ª–æ–≤`;

            const retryBtn = document.createElement('button');
            retryBtn.className = 'submit-btn';
            retryBtn.textContent = '–ò–≥—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ üîÑ';
            retryBtn.onclick = () => {
                currentLevel = 1;
                totalScore = 0;
                errorCount = 0;
                loadLevel();
            };

            finalDiv.appendChild(emoji);
            finalDiv.appendChild(title);
            finalDiv.appendChild(message);
            finalDiv.appendChild(scoreDiv);
            finalDiv.appendChild(retryBtn);

            container.appendChild(finalDiv);
        }

        function startTimer(seconds, onTick, onTimeout) {
            clearInterval(timerInterval);
            currentTimer = seconds;
            
            const timerDiv = document.createElement('div');
            timerDiv.className = 'timer';
            timerDiv.id = 'timer-display';
            timerDiv.textContent = `‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å: ${currentTimer} —Å–µ–∫`;
            
            const container = document.getElementById('task-container');
            container.insertBefore(timerDiv, container.firstChild);

            timerInterval = setInterval(() => {
                currentTimer--;
                timerDiv.textContent = `‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å: ${currentTimer} —Å–µ–∫`;
                
                if (currentTimer <= 10) {
                    timerDiv.classList.add('warning');
                }
                
                if (onTick) onTick(currentTimer);
                
                if (currentTimer <= 0) {
                    clearInterval(timerInterval);
                    if (onTimeout) onTimeout();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            const timerDiv = document.getElementById('timer-display');
            if (timerDiv) timerDiv.remove();
        }

        function loadLevel() {
            if (currentLevel > maxLevels) {
                showFinalScreen();
                return;
            }

            stopTimer();
            updateProgress();
            const level = levels[currentLevel - 1];
            const container = document.getElementById('task-container');
            container.innerHTML = '';

            const title = document.createElement('div');
            title.className = 'task-title';
            title.textContent = level.question;
            container.appendChild(title);

            switch(level.type) {
                case 'math':
                case 'word':
                case 'sequence':
                    loadInputLevel(level, container);
                    break;
                case 'quiz':
                case 'riddle':
                    loadQuizLevel(level, container);
                    break;
                case 'colors':
                    loadColorLevel(level, container);
                    break;
                case 'memory':
                    loadMemoryLevel(level, container);
                    break;
                case 'drawing':
                    loadDrawingLevel(level, container);
                    break;
                case 'sorting':
                    loadSortingLevel(level, container);
                    break;
                case 'shapes':
                    loadShapesLevel(level, container);
                    break;
                case 'slider':
                    loadSliderLevel(level, container);
                    break;
            }
        }

        function loadInputLevel(level, container) {
            const input = document.createElement('input');
            input.type = level.type === 'math' || level.type === 'sequence' ? 'number' : 'text';
            input.className = level.type === 'math' || level.type === 'sequence' ? 'math-input' : 'word-input';
            input.placeholder = '–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç...';
            
            const button = document.createElement('button');
            button.className = 'submit-btn';
            button.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ‚úì';
            
            button.onclick = () => {
                const userAnswer = level.type === 'word' 
                    ? input.value.toLowerCase().trim() 
                    : parseInt(input.value);
                
                if (userAnswer === level.answer) {
                    totalScore += pointsPerLevel;
                    showFeedback(true);
                    setTimeout(() => {
                        currentLevel++;
                        loadLevel();
                    }, 2000);
                } else {
                    errorCount++;
                    updateProgress();
                    showFeedback(false);
                    
                    if (checkGameOver()) return;
                    
                    input.value = '';
                    input.focus();
                }
            };

            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') button.click();
            });

            container.appendChild(input);
            container.appendChild(button);
            input.focus();
        }

        function loadQuizLevel(level, container) {
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options';

            level.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => {
                    if (index === level.answer) {
                        totalScore += pointsPerLevel;
                        showFeedback(true);
                        setTimeout(() => {
                            currentLevel++;
                            loadLevel();
                        }, 2000);
                    } else {
                        errorCount++;
                        updateProgress();
                        showFeedback(false);
                        checkGameOver();
                    }
                };
                optionsDiv.appendChild(btn);
            });

            container.appendChild(optionsDiv);
        }

        function loadColorLevel(level, container) {
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'color-options';

            level.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'color-btn';
                btn.textContent = option.text;
                btn.style.background = option.color;
                btn.style.color = 'white';
                btn.style.fontWeight = 'bold';
                btn.onclick = () => {
                    if (index === level.answer) {
                        totalScore += pointsPerLevel;
                        showFeedback(true);
                        setTimeout(() => {
                            currentLevel++;
                            loadLevel();
                        }, 2000);
                    } else {
                        errorCount++;
                        updateProgress();
                        showFeedback(false);
                        checkGameOver();
                    }
                };
                optionsDiv.appendChild(btn);
            });

            container.appendChild(optionsDiv);
        }

        function loadMemoryLevel(level, container) {
            const emojis = [...level.emojis, ...level.emojis].sort(() => Math.random() - 0.5);
            let flippedCards = [];
            let matchedPairs = 0;
            let isProcessing = false;

            const grid = document.createElement('div');
            grid.className = 'memory-grid';

            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            if (level.timeLimit) {
                startTimer(level.timeLimit, null, () => {
                    errorCount++;
                    updateProgress();
                    showFeedback(false);
                    
                    if (!checkGameOver()) {
                        setTimeout(() => {
                            currentLevel++;
                            loadLevel();
                        }, 2000);
                    }
                });
            }

            emojis.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.emoji = emoji;
                card.dataset.index = index;

                card.onclick = () => {
                    if (isProcessing || flippedCards.length >= 2 || card.classList.contains('flipped') || card.classList.contains('matched')) {
                        return;
                    }

                    card.classList.add('flipped');
                    card.textContent = emoji;
                    flippedCards.push(card);

                    if (flippedCards.length === 2) {
                        isProcessing = true;
                        
                        setTimeout(() => {
                            if (flippedCards[0].dataset.emoji === flippedCards[1].dataset.emoji) {
                                flippedCards.forEach(c => c.classList.add('matched'));
                                matchedPairs++;
                                
                                if (matchedPairs === level.emojis.length) {
                                    stopTimer();
                                    totalScore += pointsPerLevel;
                                    showFeedback(true);
                                    setTimeout(() => {
                                        currentLevel++;
                                        loadLevel();
                                    }, 2000);
                                }
                            } else {
                                flippedCards.forEach(c => {
                                    c.classList.remove('flipped');
                                    c.textContent = '';
                                });
                            }
                            flippedCards = [];
                            isProcessing = false;
                        }, 800);
                    }
                };

                grid.appendChild(card);
            });

            container.appendChild(grid);
        }

        function loadDrawingLevel(level, container) {
            const canvas = document.createElement('canvas');
            canvas.className = 'drawing-canvas';
            canvas.width = 400;
            canvas.height = 400;
            
            if (window.innerWidth < 480) {
                canvas.width = window.innerWidth - 80;
                canvas.height = window.innerWidth - 80;
            }

            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';

            let isDrawing = false;

            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                ctx.beginPath();
                ctx.moveTo(x, y);
            }

            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                ctx.lineTo(x, y);
                ctx.stroke();
            }

            function stopDrawing() {
                isDrawing = false;
            }

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);

            const palette = document.createElement('div');
            palette.className = 'color-palette';
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
            
            colors.forEach(color => {
                const colorBtn = document.createElement('div');
                colorBtn.className = 'color-choice';
                                colorBtn.style.background = color;
                if (color === '#FFD700') colorBtn.classList.add('active');
                colorBtn.onclick = () => {
                    document.querySelectorAll('.color-choice').forEach(c => c.classList.remove('active'));
                    colorBtn.classList.add('active');
                    ctx.strokeStyle = color;
                };
                palette.appendChild(colorBtn);
            });

            const button = document.createElement('button');
            button.className = 'submit-btn';
            button.textContent = '–ì–æ—Ç–æ–≤–æ! ‚úì';
            button.onclick = () => {
                totalScore += pointsPerLevel;
                showFeedback(true);
                setTimeout(() => {
                    currentLevel++;
                    loadLevel();
                }, 2000);
            };

            container.appendChild(palette);
            container.appendChild(canvas);
            container.appendChild(button);
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        function loadSortingLevel(level, container) {
            const sortingDiv = document.createElement('div');
            sortingDiv.className = 'sorting-container';
            
            let draggedElement = null;

            level.items.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sort-item';
                itemDiv.textContent = item;
                itemDiv.draggable = true;
                itemDiv.dataset.value = item;

                itemDiv.addEventListener('dragstart', (e) => {
                    draggedElement = itemDiv;
                    setTimeout(() => itemDiv.classList.add('dragging'), 0);
                });

                itemDiv.addEventListener('dragend', () => {
                    itemDiv.classList.remove('dragging');
                });

                itemDiv.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                itemDiv.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedElement !== itemDiv) {
                        const allItems = [...sortingDiv.children];
                        const draggedIndex = allItems.indexOf(draggedElement);
                        const targetIndex = allItems.indexOf(itemDiv);

                        if (draggedIndex < targetIndex) {
                            sortingDiv.insertBefore(draggedElement, itemDiv.nextSibling);
                        } else {
                            sortingDiv.insertBefore(draggedElement, itemDiv);
                        }
                    }
                });

                // Touch support
                itemDiv.addEventListener('touchstart', (e) => {
                    draggedElement = itemDiv;
                    itemDiv.classList.add('dragging');
                });

                itemDiv.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const targetElement = document.elementFromPoint(touch.clientX, touch.clientY);
                    if (targetElement && targetElement.classList.contains('sort-item') && targetElement !== draggedElement) {
                        const allItems = [...sortingDiv.children];
                        const draggedIndex = allItems.indexOf(draggedElement);
                        const targetIndex = allItems.indexOf(targetElement);

                        if (draggedIndex < targetIndex) {
                            sortingDiv.insertBefore(draggedElement, targetElement.nextSibling);
                        } else {
                            sortingDiv.insertBefore(draggedElement, targetElement);
                        }
                    }
                });

                itemDiv.addEventListener('touchend', () => {
                    itemDiv.classList.remove('dragging');
                });

                sortingDiv.appendChild(itemDiv);
            });

            const button = document.createElement('button');
            button.className = 'submit-btn';
            button.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ ‚úì';
            button.onclick = () => {
                const currentOrder = [...sortingDiv.children].map(item => item.dataset.value);
                const isCorrect = JSON.stringify(currentOrder) === JSON.stringify(level.correctOrder);

                if (isCorrect) {
                    totalScore += pointsPerLevel;
                    showFeedback(true);
                    setTimeout(() => {
                        currentLevel++;
                        loadLevel();
                    }, 2000);
                } else {
                    errorCount++;
                    updateProgress();
                    showFeedback(false);
                    checkGameOver();
                }
            };

            container.appendChild(sortingDiv);
            container.appendChild(button);
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –§–æ—Ä–º—ã
        function loadShapesLevel(level, container) {
            const shapeGrid = document.createElement('div');
            shapeGrid.className = 'shape-grid';
            
            const selectedShapes = new Set();

            level.shapes.forEach((shape, index) => {
                const shapeDiv = document.createElement('div');
                shapeDiv.className = 'shape-item';
                shapeDiv.textContent = shape.emoji;
                shapeDiv.dataset.index = index;
                shapeDiv.dataset.isSquare = shape.isSquare;

                shapeDiv.onclick = () => {
                    if (selectedShapes.has(index)) {
                        selectedShapes.delete(index);
                        shapeDiv.classList.remove('selected');
                    } else {
                        selectedShapes.add(index);
                        shapeDiv.classList.add('selected');
                    }
                };

                shapeGrid.appendChild(shapeDiv);
            });

            const button = document.createElement('button');
            button.className = 'submit-btn';
            button.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–±–æ—Ä ‚úì';
            button.onclick = () => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±—Ä–∞–Ω—ã –≤—Å–µ –∫–≤–∞–¥—Ä–∞—Ç—ã –∏ —Ç–æ–ª—å–∫–æ –∫–≤–∞–¥—Ä–∞—Ç—ã
                const correctSquares = level.shapes
                    .map((s, i) => s.isSquare ? i : -1)
                    .filter(i => i !== -1);
                
                const isCorrect = correctSquares.length === selectedShapes.size &&
                    correctSquares.every(i => selectedShapes.has(i));

                if (isCorrect) {
                    totalScore += pointsPerLevel;
                    showFeedback(true);
                    setTimeout(() => {
                        currentLevel++;
                        loadLevel();
                    }, 2000);
                } else {
                    errorCount++;
                    updateProgress();
                    showFeedback(false);
                    
                    if (!checkGameOver()) {
                        // –û—á–∏—â–∞–µ–º –≤—ã–±–æ—Ä
                        selectedShapes.clear();
                        document.querySelectorAll('.shape-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                    }
                }
            };

            container.appendChild(shapeGrid);
            container.appendChild(button);
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –°–ª–∞–π–¥–µ—Ä
        function loadSliderLevel(level, container) {
            const sliderContainer = document.createElement('div');
            sliderContainer.className = 'slider-container';

            const valueDisplay = document.createElement('div');
            valueDisplay.className = 'slider-value';
            valueDisplay.textContent = '50';

            const slider = document.createElement('input');
            slider.type = 'range';
            slider.className = 'slider';
            slider.min = '0';
            slider.max = '100';
            slider.value = '50';

            slider.oninput = () => {
                valueDisplay.textContent = slider.value;
            };

            const button = document.createElement('button');
            button.className = 'submit-btn';
            button.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ‚úì';
            button.onclick = () => {
                const userValue = parseInt(slider.value);
                
                if (userValue === level.targetValue) {
                    totalScore += pointsPerLevel;
                    showFeedback(true);
                    setTimeout(() => {
                        currentLevel++;
                        loadLevel();
                    }, 2000);
                } else {
                    errorCount++;
                    updateProgress();
                    
                    const diff = Math.abs(userValue - level.targetValue);
                    const feedback = document.createElement('div');
                    feedback.className = 'feedback incorrect';
                    
                    if (diff <= 5) {
                        feedback.textContent = 'üî• –û—á–µ–Ω—å –±–ª–∏–∑–∫–æ! –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —á—É—Ç—å-—á—É—Ç—å!';
                    } else if (diff <= 10) {
                        feedback.textContent = 'üëç –ü–æ—á—Ç–∏! –ï—â—ë –Ω–µ–º–Ω–æ–≥–æ!';
                    } else {
                        feedback.textContent = userValue < level.targetValue ? 
                            '‚¨ÜÔ∏è –ù—É–∂–Ω–æ –±–æ–ª—å—à–µ!' : '‚¨áÔ∏è –ù—É–∂–Ω–æ –º–µ–Ω—å—à–µ!';
                    }
                    
                    container.insertBefore(feedback, container.firstChild);
                    setTimeout(() => feedback.remove(), 2000);
                    
                    checkGameOver();
                }
            };

            sliderContainer.appendChild(valueDisplay);
            sliderContainer.appendChild(slider);
            container.appendChild(sliderContainer);
            container.appendChild(button);
        }

        function showFinalScreen() {
            const container = document.getElementById('task-container');
            container.innerHTML = '';

            const finalDiv = document.createElement('div');
            finalDiv.className = 'final-screen';

            const scoreDiv = document.createElement('div');
            scoreDiv.className = 'score';
            scoreDiv.innerHTML = `
                –¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${totalScore} –∏–∑ ${maxScore} –±–∞–ª–ª–æ–≤!<br>
                –û—à–∏–±–æ–∫: ${errorCount} –∏–∑ ${maxErrors}
            `;

            finalDiv.appendChild(scoreDiv);

            // –ü–æ—Ä–æ–≥ –¥–ª—è –ø–æ–±–µ–¥—ã: –º–∏–Ω–∏–º—É–º 90 –±–∞–ª–ª–æ–≤ (9 –∏–∑ 13 —É—Ä–æ–≤–Ω–µ–π) –∏ –Ω–µ –±–æ–ª–µ–µ 3 –æ—à–∏–±–æ–∫
            if (totalScore >= 90 && errorCount < maxErrors) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji';
                emoji.textContent = 'üéâüèÜüéä';

                const title = document.createElement('h2');
                title.textContent = '–ü–û–ó–î–†–ê–í–õ–Ø–Æ!';

                const message = document.createElement('p');
                message.innerHTML = `
                    <strong>–ú–æ–ª–æ–¥–µ—Ü, –í–µ—Ä–æ—á–∫–∞!</strong><br><br>
                    –¢—ã –ø—Ä–æ—à–ª–∞ –≤—Å–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è! üåü<br><br>
                    –ú–æ–∂–µ—à—å –∏–¥—Ç–∏ –∫ –î—è–¥–µ –§–µ–¥–µ –∏ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–∑ - <strong>–ö–û–ù–§–ï–¢–ö–£!</strong> üç¨üç≠üç´
                `;

                finalDiv.appendChild(emoji);
                finalDiv.appendChild(title);
                finalDiv.appendChild(message);
            } else {
                const emoji = document.createElement('div');
                emoji.className = 'emoji';
                emoji.textContent = 'üí™üòä';

                const title = document.createElement('h2');
                title.textContent = '–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!';

                const message = document.createElement('p');
                message.innerHTML = `
                    –£ —Ç–µ–±—è –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è! üåà<br><br>
                    –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑, —Ç—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è! üí™<br><br>
                    ${totalScore < 90 ? '–ù—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –º–∏–Ω–∏–º—É–º 90 –±–∞–ª–ª–æ–≤! üéØ' : ''}
                `;

                const retryBtn = document.createElement('button');
                retryBtn.className = 'submit-btn';
                retryBtn.textContent = '–ò–≥—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ üîÑ';
                retryBtn.onclick = () => {
                    currentLevel = 1;
                    totalScore = 0;
                    errorCount = 0;
                    loadLevel();
                };

                finalDiv.appendChild(emoji);
                finalDiv.appendChild(title);
                finalDiv.appendChild(message);
                finalDiv.appendChild(retryBtn);
            }

            container.appendChild(finalDiv);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        loadLevel();
    </script>
</body>
</html>
