<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Приключения Финника</title>
    <style>
        /* --- ОБЩИЕ СТИЛИ ИГРЫ --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #e0f2f1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #004d40;
        }

        .game-container {
            width: 90%;
            max-width: 500px;
            background-color: #ffffff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .level, #start-screen, #final-screen {
            display: none;
            flex-direction: column;
            align-items: center;
        }

        #start-screen.active,
        #final-screen.active,
        .level.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        h2 {
            font-size: 1.4rem;
            margin: 10px 0;
            color: #00796b;
        }

        p {
            font-size: 1.1rem;
        }

        button {
            background-color: #ffc107;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #444;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            margin-top: 10px;
        }

        button:hover {
            transform: scale(1.05);
            background-color: #ffca28;
        }

        #message-area {
            min-height: 40px;
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 15px;
        }
        .correct { color: #4caf50; }
        .incorrect { color: #f44336; }

        /* --- СТИЛИ ДЛЯ УРОВНЕЙ --- */
        .items-grid {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .clickable {
            font-size: 4rem;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 10px;
            border-radius: 10px;
        }

        .clickable:hover {
            transform: scale(1.1);
            background-color: rgba(255, 193, 7, 0.3);
        }

        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Стили для уровня 2 (Мемори) */
        #level-2 .clickable {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #81c784;
            color: transparent;
            font-size: 3rem;
            user-select: none;
        }
        #level-2 .clickable.flipped, 
        #level-2 .clickable.matched {
            background-color: #fff59d;
            color: #000;
        }

        /* Стили для уровня 5 (Кодовый замок) */
        #code-display {
            font-size: 2rem;
            letter-spacing: 10px;
            margin: 15px auto;
            padding: 10px;
            border: 2px dashed #00796b;
            border-radius: 10px;
            min-height: 40px;
            width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #keypad { 
            display: flex; 
            gap: 10px; 
            justify-content: center;
        }
        #keypad .clickable { 
            font-size: 2rem; 
            border: 1px solid #ccc; 
            width: 60px; 
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Стили для уровня 6 (Счёт) */
        .count-items {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        /* Стили для уровня 7 (Лабиринт) */
        #maze-container {
            display: grid;
            grid-template-columns: repeat(5, 60px);
            gap: 5px;
            margin: 20px auto;
        }
        
        .maze-cell {
            width: 60px;
            height: 60px;
            background-color: #81c784;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .maze-cell.wall {
            background-color: #424242;
        }
        
        .maze-cell.path {
            background-color: #fff59d;
        }

        /* Стили для уровня 8 (Пазл) */
        #puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 80px);
            gap: 5px;
            margin: 20px auto;
            width: fit-content;
        }
        
        .puzzle-piece {
            width: 80px;
            height: 80px;
            background-color: #81c784;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .puzzle-piece.empty {
            background-color: #e0e0e0;
        }

        /* Стили для уровня 9 (Тень) */
        .shadow-game {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .shadow-item {
            font-size: 5rem;
        }

        /* Стили для уровня 10 (Ритм) */
        .rhythm-button {
            width: 100px;
            height: 100px;
            font-size: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .rhythm-button.active-pulse {
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); background-color: #ffeb3b; }
        }

        /* Стили для уровня 11 (Найди пару) */
        .pair-items {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .pair-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .pair-item {
            padding: 15px;
            background-color: #e0f2f1;
            border-radius: 10px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .pair-item.selected {
            border-color: #ffc107;
            background-color: #fff9c4;
        }
        
        .pair-item.matched {
            background-color: #c8e6c9;
            border-color: #4caf50;
            cursor: default;
        }

        /* Стили для уровня 13 (Поймай предмет) */
        #catch-game {
            position: relative;
            width: 100%;
            height: 300px;
            background-color: #e1f5fe;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .falling-item {
            position: absolute;
            font-size: 3rem;
            cursor: pointer;
        }
        
        #basket {
            position: absolute;
            bottom: 10px;
            font-size: 4rem;
            cursor: pointer;
        }

        /* Стили для уровня 14 (Рисование) */
        #drawing-canvas {
            border: 3px solid #00796b;
            border-radius: 10px;
            cursor: crosshair;
            touch-action: none;
            margin: 10px auto;
        }
        
        .color-palette {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .color-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid #333;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-button:hover {
            transform: scale(1.1);
        }

        .color-button.selected {
            border-width: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* Стили для уровня 15 (Найди отличия) */
        #differences-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .difference-image {
            position: relative;
            font-size: 8rem;
            line-height: 1;
        }
        
        .difference-spot {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
        }
        
        .difference-spot:hover {
            background-color: rgba(255, 193, 7, 0.3);
        }
        
        .difference-spot.found {
            border-color: #4caf50;
            background-color: rgba(76, 175, 80, 0.5);
            cursor: default;
        }

        /* Прогресс бар */
        .progress-container {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <!-- Стартовый экран -->
        <div id="start-screen" class="active">
            <h1>Приключения Финника</h1>
            <p>Помоги бельчонку Финнику найти его Волшебный Жёлудь, решая 15 головоломок!</p>
            <div style="font-size: 5rem; margin: 20px 0;">🐿️</div>
            <button id="start-button">Начать игру!</button>
        </div>

        <!-- Контейнер для уровней -->
        <div id="game-area">
            <div id="game-header">
                <h1>Уровень <span id="level-number">1</span> / 15</h1>
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                </div>
                <div id="message-area"></div>
            </div>

            <!-- Уровень 1: Найди лишнее -->
            <div id="level-1" class="level">
                <h2>Найди лишний предмет</h2>
                <div class="items-grid">
                    <div class="clickable" data-correct="false">🍄</div>
                    <div class="clickable" data-correct="true">🌸</div>
                    <div class="clickable" data-correct="false">🍄</div>
                    <div class="clickable" data-correct="false">🍄</div>
                </div>
            </div>

            <!-- Уровень 2: Мемори -->
            <div id="level-2" class="level">
                <h2>Найди все пары</h2>
                <div id="memory-grid" class="items-grid"></div>
            </div>

            <!-- Уровень 3: Правильный порядок -->
            <div id="level-3" class="level">
                <h2>Нажми по порядку: от маленького к большому</h2>
                <div class="items-grid">
                    <div class="clickable" data-order="3">🌳</div>
                    <div class="clickable" data-order="1">🌱</div>
                    <div class="clickable" data-order="2">🌿</div>
                </div>
            </div>

            <!-- Уровень 4: Смешай цвета -->
            <div id="level-4" class="level">
                <h2>Смешай жёлтый и синий, чтобы получить зелёный</h2>
                <div class="items-grid">
                    <div class="clickable" data-color="yellow">🟡</div>
                    <div class="clickable" data-color="blue">🔵</div>
                    <div class="clickable" data-color="red">🔴</div>
                </div>
            </div>
            
            <!-- Уровень 5: Кодовый замок -->
            <div id="level-5" class="level">
                <h2>Введи код: 💧🍃💎</h2>
                <p>💧=1, 🍃=2, 💎=3</p>
                <div id="code-display"></div>
                <div id="keypad">
                    <div class="clickable" data-digit="1">1</div>
                    <div class="clickable" data-digit="2">2</div>
                    <div class="clickable" data-digit="3">3</div>
                </div>
            </div>

            <!-- Уровень 6: Посчитай предметы -->
            <div id="level-6" class="level">
                <h2>Сколько здесь орешков?</h2>
                <div class="count-items">
                    <span style="font-size: 3rem;">🌰</span>
                    <span style="font-size: 3rem;">🌰</span>
                    <span style="font-size: 3rem;">🌰</span>
                    <span style="font-size: 3rem;">🌰</span>
                    <span style="font-size: 3rem;">🌰</span>
                </div>
                <div class="items-grid">
                    <div class="clickable" data-answer="4">4</div>
                    <div class="clickable" data-answer="5">5</div>
                    <div class="clickable" data-answer="6">6</div>
                </div>
            </div>

            <!-- Уровень 7: Лабиринт -->
            <div id="level-7" class="level">
                <h2>Проведи белочку к жёлудю</h2>
                <p style="font-size: 0.9rem;">Нажимай на зелёные клетки по порядку</p>
                <div id="maze-container"></div>
            </div>

            <!-- Уровень 8: Пазл-пятнашки -->
            <div id="level-8" class="level">
                <h2>Собери картинку по порядку</h2>
                <p style="font-size: 0.9rem;">Нажимай на плитки рядом с пустым местом</p>
                <div id="puzzle-container"></div>
            </div>

            <!-- Уровень 9: Найди тень -->
            <div id="level-9" class="level">
                <h2>Какая тень подходит к грибу?</h2>
                <div class="shadow-game">
                    <div class="shadow-item">🍄</div>
                    <div class="items-grid">
                        <div class="clickable" data-correct="false">🌲</div>
                        <div class="clickable" data-correct="true">🍄</div>
                        <div class="clickable" data-correct="false">🌸</div>
                    </div>
                </div>
            </div>

            <!-- Уровень 10: Повтори ритм -->
            <div id="level-10" class="level">
                <h2>Запомни и повтори последовательность</h2>
                <p id="rhythm-status">Смотри внимательно!</p>
                <div class="items-grid">
                    <button class="rhythm-button clickable" data-index="0">🔴</button>
                    <button class="rhythm-button clickable" data-index="1">🔵</button>
                    <button class="rhythm-button clickable" data-index="2">🟢</button>
                    <button class="rhythm-button clickable" data-index="3">🟡</button>
                </div>
            </div>

            <!-- Уровень 11: Найди пару (соединение) -->
            <div id="level-11" class="level">
                <h2>Соедини животных с их домами</h2>
                <div class="pair-items">
                    <div class="pair-column">
                        <div class="pair-item" data-type="animal" data-id="bee">🐝 Пчела</div>
                        <div class="pair-item" data-type="animal" data-id="bird">🐦 Птица</div>
                        <div class="pair-item" data-type="animal" data-id="squirrel">🐿️ Белка</div>
                    </div>
                    <div class="pair-column">
                        <div class="pair-item" data-type="home" data-id="hive">🍯 Улей</div>
                        <div class="pair-item" data-type="home" data-id="nest">🪺 Гнездо</div>
                        <div class="pair-item" data-type="home" data-id="hollow">🌳 Дупло</div>
                    </div>
                </div>
            </div>

            <!-- Уровень 12: Математика -->
            <div id="level-12" class="level">
                <h2>Реши пример</h2>
                <p style="font-size: 2rem; margin: 20px 0;">3 + 2 = ?</p>
                <div class="math-options items-grid">
                    <div class="clickable" data-answer="4">4</div>
                    <div class="clickable" data-answer="5">5</div>
                    <div class="clickable" data-answer="6">6</div>
                </div>
            </div>

            <!-- Уровень 13: Поймай предметы -->
            <div id="level-13" class="level">
                <h2>Поймай 5 орешков!</h2>
                <p>Пойманы: <span id="caught-count">0</span> / 5</p>
                <div id="catch-game">
                    <div id="basket">🧺</div>
                </div>
            </div>

            <!-- Уровень 14: Нарисуй фигуру -->
            <div id="level-14" class="level">
                <h2>Нарисуй круг 🔵</h2>
                <div class="color-palette">
                    <div class="color-button selected" style="background: red;" data-color="red"></div>
                    <div class="color-button" style="background: blue;" data-color="blue"></div>
                    <div class="color-button" style="background: green;" data-color="green"></div>
                    <div class="color-button" style="background: yellow;" data-color="yellow"></div>
                </div>
                <canvas id="drawing-canvas" width="300" height="300"></canvas>
                <div>
                    <button id="clear-canvas">Очистить</button>
                    <button id="check-drawing">Готово! Проверить</button>
                </div>
            </div>

            <!-- Уровень 15: Найди 3 отличия -->
            <div id="level-15" class="level">
                <h2>Найди 3 отличия на картинке справа</h2>
                <p>Найдено: <span id="differences-found">0</span> / 3</p>
                <div id="differences-container">
                    <div style="position: relative;">
                        <div class="difference-image">🏠</div>
                    </div>
                    <div style="position: relative;">
                        <div class="difference-image">🏠</div>
                        <div class="difference-spot" data-diff="1" style="top: 20px; left: 30px;"></div>
                        <div class="difference-spot" data-diff="2" style="top: 80px; left: 80px;"></div>
                        <div class="difference-spot" data-diff="3" style="top: 120px; left: 40px;"></div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Финальный экран -->
        <div id="final-screen">
            <h1>🎉 Ура! Победа! 🎉</h1>
            <p>Ты помог Финнику найти его Волшебный Жёлудь! Ты прошёл все 15 уровней!</p>
            <div style="font-size: 5rem;">🏆🐿️🌰</div>
            <p style="font-size: 2rem; margin: 20px 0;">⭐⭐⭐</p>
            <p>Ты настоящий герой!</p>
            <button id="restart-button">Играть снова</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let currentLevel = 1;
            const totalLevels = 15;

            const startScreen = document.getElementById('start-screen');
            const gameArea = document.getElementById('game-area');
            const finalScreen = document.getElementById('final-screen');
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            const levelNumberEl = document.getElementById('level-number');
            const messageArea = document.getElementById('message-area');
            const progressBar = document.getElementById('progress-bar');

            function startGame() {
                currentLevel = 1;
                startScreen.classList.remove('active');
                finalScreen.classList.remove('active');
                gameArea.style.display = 'block';
                showLevel(currentLevel);
            }

            function updateProgressBar() {
                const progress = ((currentLevel - 1) / totalLevels) * 100;
                progressBar.style.width = progress + '%';
                progressBar.textContent = Math.round(progress) + '%';
            }

            function showLevel(levelNum) {
                document.querySelectorAll('.level').forEach(lvl => {
                    lvl.classList.remove('active');
                });
                
                if (levelNum <= totalLevels) {
                    const levelToShow = document.getElementById(`level-${levelNum}`);
                    levelToShow.classList.add('active');
                    levelNumberEl.textContent = levelNum;
                    messageArea.textContent = '';
                    messageArea.className = '';
                    updateProgressBar();
                    
                    if (levelNum === 2) initLevel2();
                    if (levelNum === 3) initLevel3();
                    if (levelNum === 4) initLevel4();
                    if (levelNum === 5) initLevel5();
                    if (levelNum === 7) initLevel7();
                    if (levelNum === 8) initLevel8();
                    if (levelNum === 10) initLevel10();
                    if (levelNum === 11) initLevel11();
                    if (levelNum === 13) initLevel13();
                    if (levelNum === 14) initLevel14();
                    if (levelNum === 15) initLevel15();
                } else {
                    showFinalScreen();
                }
            }
            
            function showFinalScreen() {
                gameArea.style.display = 'none';
                finalScreen.classList.add('active');
            }

            function handleCorrect() {
                messageArea.textContent = 'Правильно! 🎉';
                messageArea.className = 'correct';
                setTimeout(() => {
                    currentLevel++;
                    showLevel(currentLevel);
                }, 1500);
            }

            function handleIncorrect(element) {
                messageArea.textContent = 'Попробуй ещё раз! 🤔';
                messageArea.className = 'incorrect';
                if (element) {
                    element.classList.add('shake');
                    setTimeout(() => element.classList.remove('shake'), 500);
                }
            }

            // === УРОВЕНЬ 1: Найди лишнее ===
            function initLevel1() {
                document.querySelectorAll('#level-1 .clickable').forEach(item => {
                    const newItem = item.cloneNode(true);
                    item.parentNode.replaceChild(newItem, item);
                    
                    newItem.addEventListener('click', () => {
                        if (newItem.dataset.correct === 'true') {
                            handleCorrect();
                        } else {
                            handleIncorrect(newItem);
                        }
                    });
                });
            }
            initLevel1();
            
            // === УРОВЕНЬ 2: Мемори ===
            let flippedCards = [];
            let matchedPairs = 0;
            let lockBoard = false;
            
            function initLevel2() {
                const grid = document.getElementById('memory-grid');
                grid.innerHTML = '';
                const emojis = ['🍓', '🍓', '🍌', '🍌', '🍇', '🍇'];
                emojis.sort(() => 0.5 - Math.random());
                
                flippedCards = [];
                matchedPairs = 0;
                lockBoard = false;
                
                emojis.forEach(emoji => {
                    const card = document.createElement('div');
                    card.classList.add('clickable');
                    card.dataset.emoji = emoji;
                    card.textContent = emoji;
                    card.addEventListener('click', flipCard);
                    grid.appendChild(card);
                });
            }
            
            function flipCard() {
                if (lockBoard) return;
                if (this === flippedCards[0]) return;
                if (this.classList.contains('matched')) return;

                this.classList.add('flipped');

                if (flippedCards.length === 0) {
                    flippedCards.push(this);
                    return;
                }

                flippedCards.push(this);
                lockBoard = true;

                if (flippedCards[0].dataset.emoji === flippedCards[1].dataset.emoji) {
                    flippedCards[0].classList.add('matched');
                    flippedCards[1].classList.add('matched');
                    matchedPairs++;
                    resetBoard();
                    if (matchedPairs === 3) {
                       setTimeout(handleCorrect, 500);
                    }
                } else {
                    setTimeout(() => {
                        flippedCards[0].classList.remove('flipped');
                        flippedCards[1].classList.remove('flipped');
                        resetBoard();
                    }, 1000);
                }
            }
            
            function resetBoard() {
                flippedCards = [];
                lockBoard = false;
            }

            // === УРОВЕНЬ 3: Правильный порядок ===
            let sequence = [];
            const correctSequence = ['1', '2', '3'];
            
            function initLevel3() {
                sequence = [];
                const items = document.querySelectorAll('#level-3 .clickable');
                items.forEach(item => {
                    item.style.backgroundColor = '';
                    const newItem = item.cloneNode(true);
                    item.parentNode.replaceChild(newItem, item);
                    
                    newItem.addEventListener('click', () => {
                        if (sequence.length < 3) {
                            sequence.push(newItem.dataset.order);
                            newItem.style.backgroundColor = 'rgba(255, 193, 7, 0.5)';
                            
                            if (sequence.length === 3) {
                                if (JSON.stringify(sequence) === JSON.stringify(correctSequence)) {
                                    handleCorrect();
                                } else {
                                    handleIncorrect(null);
                                    setTimeout(() => {
                                        initLevel3();
                                    }, 1000);
                                }
                            }
                        }
                    });
                });
            }

       </div>

        <div id="level-10" class="level">
            <h2>Запомни и повтори последовательность</h2>
            <p id="rhythm-status">Смотри внимательно!</p>
            <div class="items-grid">
                <button class="rhythm-button clickable" data-index="0">🔴</button>
                <button class="rhythm-button clickable" data-index="1">🔵</button>
                <button class="rhythm-button clickable" data-index="2">🟢</button>
                <button class="rhythm-button clickable" data-index="3">🟡</button>
            </div>
        </div>

        <div id="level-11" class="level">
            <h2>Соедини животных с их домами</h2>
            <div class="pair-items">
                <div class="pair-column">
                    <div class="pair-item" data-type="animal" data-id="bee">🐝 Пчела</div>
                    <div class="pair-item" data-type="animal" data-id="bird">🐦 Птица</div>
                    <div class="pair-item" data-type="animal" data-id="squirrel">🐿️ Белка</div>
                </div>
                <div class="pair-column">
                    <div class="pair-item" data-type="home" data-id="hive">🍯 Улей</div>
                    <div class="pair-item" data-type="home" data-id="nest">🪺 Гнездо</div>
                    <div class="pair-item" data-type="home" data-id="hollow">🌳 Дупло</div>
                </div>
            </div>
        </div>

        <div id="level-12" class="level">
            <h2>Реши пример</h2>
            <p style="font-size: 2rem; margin: 20px 0;">3 + 2 = ?</p>
            <div class="math-options items-grid">
                <div class="clickable" data-answer="4">4</div>
                <div class="clickable" data-answer="5">5</div>
                <div class="clickable" data-answer="6">6</div>
            </div>
        </div>

        <div id="level-13" class="level">
            <h2>Поймай 5 орешков!</h2>
            <p>Пойманы: <span id="caught-count">0</span> / 5</p>
            <div id="catch-game">
                <div id="basket">🧺</div>
            </div>
        </div>

        <div id="level-14" class="level">
            <h2>Нарисуй круг 🔵</h2>
            <div class="color-palette">
                <div class="color-button selected" style="background: red;" data-color="red"></div>
                <div class="color-button" style="background: blue;" data-color="blue"></div>
                <div class="color-button" style="background: green;" data-color="green"></div>
                <div class="color-button" style="background: yellow;" data-color="yellow"></div>
            </div>
            <canvas id="drawing-canvas" width="300" height="300"></canvas>
            <div>
                <button id="clear-canvas">Очистить</button>
                <button id="check-drawing">Готово!</button>
            </div>
        </div>

        <div id="level-15" class="level">
            <h2>Найди 3 отличия справа</h2>
            <p>Найдено: <span id="differences-found">0</span> / 3</p>
            <div id="differences-container">
                <div style="position: relative;">
                    <div class="difference-image">🏠</div>
                </div>
                <div style="position: relative;">
                    <div class="difference-image">🏠</div>
                    <div class="difference-spot" data-diff="1" style="top: 20px; left: 30px;"></div>
                    <div class="difference-spot" data-diff="2" style="top: 80px; left: 80px;"></div>
                    <div class="difference-spot" data-diff="3" style="top: 120px; left: 40px;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="final-screen">
        <h1>🎉 Ура! Победа! 🎉</h1>
        <p>Ты помог Финнику найти его Волшебный Жёлудь!</p>
        <div style="font-size: 5rem;">🏆🐿️🌰</div>
        <p style="font-size: 2rem; margin: 20px 0;">⭐⭐⭐</p>
        <button id="restart-button">Играть снова</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        let currentLevel = 1;
        const totalLevels = 15;

        const startScreen = document.getElementById('start-screen');
        const gameArea = document.getElementById('game-area');
        const finalScreen = document.getElementById('final-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const levelNumberEl = document.getElementById('level-number');
        const messageArea = document.getElementById('message-area');
        const progressBar = document.getElementById('progress-bar');

        function startGame() {
            currentLevel = 1;
            startScreen.classList.remove('active');
            finalScreen.classList.remove('active');
            gameArea.style.display = 'block';
            showLevel(currentLevel);
        }

        function updateProgressBar() {
            const progress = ((currentLevel - 1) / totalLevels) * 100;
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }

        function showLevel(levelNum) {
            document.querySelectorAll('.level').forEach(lvl => lvl.classList.remove('active'));
            
            if (levelNum <= totalLevels) {
                const levelToShow = document.getElementById(`level-${levelNum}`);
                levelToShow.classList.add('active');
                levelNumberEl.textContent = levelNum;
                messageArea.textContent = '';
                messageArea.className = '';
                updateProgressBar();
                
                if (levelNum === 2) initLevel2();
                if (levelNum === 3) initLevel3();
                if (levelNum === 4) initLevel4();
                if (levelNum === 5) initLevel5();
                if (levelNum === 6) initLevel6();
                if (levelNum === 7) initLevel7();
                if (levelNum === 8) initLevel8();
                if (levelNum === 9) initLevel9();
                if (levelNum === 10) initLevel10();
                if (levelNum === 11) initLevel11();
                if (levelNum === 12) initLevel12();
                if (levelNum === 13) initLevel13();
                if (levelNum === 14) initLevel14();
                if (levelNum === 15) initLevel15();
            } else {
                showFinalScreen();
            }
        }
        
        function showFinalScreen() {
            gameArea.style.display = 'none';
            finalScreen.classList.add('active');
        }

        function handleCorrect() {
            messageArea.textContent = 'Правильно! 🎉';
            messageArea.className = 'correct';
            setTimeout(() => {
                currentLevel++;
                showLevel(currentLevel);
            }, 1500);
        }

        function handleIncorrect(element) {
            messageArea.textContent = 'Попробуй ещё раз! 🤔';
            messageArea.className = 'incorrect';
            if (element) {
                element.classList.add('shake');
                setTimeout(() => element.classList.remove('shake'), 500);
            }
        }

        // УРОВЕНЬ 1
        function initLevel1() {
            document.querySelectorAll('#level-1 .clickable').forEach(item => {
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
                newItem.addEventListener('click', () => {
                    if (newItem.dataset.correct === 'true') handleCorrect();
                    else handleIncorrect(newItem);
                });
            });
        }
        initLevel1();
        
        // УРОВЕНЬ 2
        let flippedCards = [], matchedPairs = 0, lockBoard = false;
        
        function initLevel2() {
            const grid = document.getElementById('memory-grid');
            grid.innerHTML = '';
            const emojis = ['🍓', '🍓', '🍌', '🍌', '🍇', '🍇'];
            emojis.sort(() => 0.5 - Math.random());
            flippedCards = [];
            matchedPairs = 0;
            lockBoard = false;
            
            emojis.forEach(emoji => {
                const card = document.createElement('div');
                card.classList.add('clickable');
                card.dataset.emoji = emoji;
                card.textContent = emoji;
                card.addEventListener('click', flipCard);
                grid.appendChild(card);
            });
        }
        
        function flipCard() {
            if (lockBoard || this === flippedCards[0] || this.classList.contains('matched')) return;
            this.classList.add('flipped');

            if (flippedCards.length === 0) {
                flippedCards.push(this);
                return;
            }

            flippedCards.push(this);
            lockBoard = true;

            if (flippedCards[0].dataset.emoji === flippedCards[1].dataset.emoji) {
                flippedCards[0].classList.add('matched');
                flippedCards[1].classList.add('matched');
                matchedPairs++;
                flippedCards = [];
                lockBoard = false;
                if (matchedPairs === 3) setTimeout(handleCorrect, 500);
            } else {
                setTimeout(() => {
                    flippedCards[0].classList.remove('flipped');
                    flippedCards[1].classList.remove('flipped');
                    flippedCards = [];
                    lockBoard = false;
                }, 1000);
            }
        }

        // УРОВЕНЬ 3
        let sequence = [];
        const correctSequence = ['1', '2', '3'];
        
        function initLevel3() {
            sequence = [];
            document.querySelectorAll('#level-3 .clickable').forEach(item => {
                item.style.backgroundColor = '';
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
                newItem.addEventListener('click', () => {
                    if (sequence.length < 3) {
                        sequence.push(newItem.dataset.order);
                        newItem.style.backgroundColor = 'rgba(255, 193, 7, 0.5)';
                        if (sequence.length === 3) {
                            if (JSON.stringify(sequence) === JSON.stringify(correctSequence)) handleCorrect();
                            else {
                                handleIncorrect(null);
                                setTimeout(initLevel3, 1000);
                            }
                        }
                    }
                });
            });
        }

        // УРОВЕНЬ 4
        let mixedColors = new Set();
        
        function initLevel4() {
            mixedColors.clear();
            document.querySelectorAll('#level-4 .clickable').forEach(item => {
                item.style.backgroundColor = '';
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
                newItem.addEventListener('click', () => {
                    const color = newItem.dataset.color;
                    if (color === 'red') {
                        handleIncorrect(newItem);
                        return;
                    }
                    if (!mixedColors.has(color)) {
                        mixedColors.add(color);
                        newItem.style.backgroundColor = 'rgba(255, 193, 7, 0.5)';
                    }
                    if (mixedColors.has('yellow') && mixedColors.has('blue')) handleCorrect();
                });
            });
        }
        
        // УРОВЕНЬ 5
        let enteredCode = '';
        const correctCode = '123';
        const codeDisplay = document.getElementById('code-display');
        
        function initLevel5() {
            enteredCode = '';
            codeDisplay.textContent = '';
            document.querySelectorAll('#level-5 .clickable').forEach(item => {
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
                newItem.addEventListener('click', () => {
                    if (enteredCode.length < 3) {
                        enteredCode += newItem.dataset.digit;
                        codeDisplay.textContent = enteredCode;
                        if(enteredCode.length === 3) {
                            if (enteredCode === correctCode) handleCorrect();
                            else {
                                handleIncorrect(null);
                                setTimeout(initLevel5, 1000);
                            }
                        }
                    }
                });
            });
        }

        // УРОВЕНЬ 6
        function initLevel6() {
            document.querySelectorAll('#level-6 .clickable').forEach(item => {
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
                newItem.addEventListener('click', () => {
                    if (newItem.dataset.answer === '5') handleCorrect();
                    else handleIncorrect(newItem);
                });
            });
        }
// УРОВЕНЬ 7 - Лабиринт
            function initLevel7() {
                const container = document.getElementById('maze-container');
                container.innerHTML = '';
                const maze = [
                    ['🐿️', 0, 1, 1, 1],
                    [0, 0, 1, 1, 1],
                    [1, 0, 0, 1, 1],
                    [1, 1, 0, 0, 1],
                    [1, 1, 1, 0, '🌰']
                ];
                
                const correctPath = [[0,0], [1,0], [1,1], [2,1], [2,2], [3,2], [3,3], [4,3], [4,4]];
                let pathIndex = 0;
                
                maze.forEach((row, i) => {
                    row.forEach((cell, j) => {
                        const div = document.createElement('div');
                        div.className = 'maze-cell';
                        if (cell === 1) div.classList.add('wall');
                        div.textContent = typeof cell === 'string' ? cell : '';
                        
                        div.addEventListener('click', () => {
                            if (cell === 1) {
                                handleIncorrect(div);
                                return;
                            }
                            
                            const expectedCell = correctPath[pathIndex];
                            if (expectedCell && expectedCell[0] === i && expectedCell[1] === j) {
                                div.classList.add('path');
                                pathIndex++;
                                if (pathIndex === correctPath.length) {
                                    setTimeout(handleCorrect, 500);
                                }
                            } else {
                                handleIncorrect(div);
                            }
                        });
                        
                        container.appendChild(div);
                    });
                });
            }

            // УРОВЕНЬ 8 - Пазл 15
            function initLevel8() {
                const container = document.getElementById('puzzle-container');
                container.innerHTML = '';
                let tiles = [1, 2, 3, 4, 5, 6, 7, 8, 0];
                
                // Перемешиваем
                for (let i = 0; i < 50; i++) {
                    const emptyIndex = tiles.indexOf(0);
                    const moves = [];
                    if (emptyIndex % 3 > 0) moves.push(emptyIndex - 1); // влево
                    if (emptyIndex % 3 < 2) moves.push(emptyIndex + 1); // вправо
                    if (emptyIndex >= 3) moves.push(emptyIndex - 3); // вверх
                    if (emptyIndex < 6) moves.push(emptyIndex + 3); // вниз
                    const randomMove = moves[Math.floor(Math.random() * moves.length)];
                    [tiles[emptyIndex], tiles[randomMove]] = [tiles[randomMove], tiles[emptyIndex]];
                }
                
                function render() {
                    container.innerHTML = '';
                    tiles.forEach((num, index) => {
                        const div = document.createElement('div');
                        div.className = 'puzzle-piece';
                        if (num === 0) {
                            div.classList.add('empty');
                            div.textContent = '';
                        } else {
                            div.textContent = num;
                        }
                        
                        div.addEventListener('click', () => {
                            const emptyIndex = tiles.indexOf(0);
                            const canMove = 
                                (index === emptyIndex - 1 && emptyIndex % 3 !== 0) ||
                                (index === emptyIndex + 1 && index % 3 !== 0) ||
                                (index === emptyIndex - 3) ||
                                (index === emptyIndex + 3);
                            
                            if (canMove) {
                                [tiles[emptyIndex], tiles[index]] = [tiles[index], tiles[emptyIndex]];
                                render();
                                
                                if (tiles.join('') === '123456780') {
                                    setTimeout(handleCorrect, 500);
                                }
                            }
                        });
                        
                        container.appendChild(div);
                    });
                }
                render();
            }

            // УРОВЕНЬ 9
            function initLevel9() {
                document.querySelectorAll('#level-9 .clickable').forEach(item => {
                    const newItem = item.cloneNode(true);
                    item.parentNode.replaceChild(newItem, item);
                    newItem.addEventListener('click', () => {
                        if (newItem.dataset.correct === 'true') handleCorrect();
                        else handleIncorrect(newItem);
                    });
                });
            }

            // УРОВЕНЬ 10 - Повтори ритм
            function initLevel10() {
                const buttons = document.querySelectorAll('#level-10 .rhythm-button');
                const statusEl = document.getElementById('rhythm-status');
                let sequence = [];
                let playerSequence = [];
                let isPlaying = false;
                
                function generateSequence() {
                    sequence = [];
                    for (let i = 0; i < 4; i++) {
                        sequence.push(Math.floor(Math.random() * 4));
                    }
                }
                
                async function playSequence() {
                    isPlaying = true;
                    statusEl.textContent = 'Смотри внимательно!';
                    
                    for (let i = 0; i < sequence.length; i++) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                        buttons[sequence[i]].classList.add('active-pulse');
                        await new Promise(resolve => setTimeout(resolve, 500));
                        buttons[sequence[i]].classList.remove('active-pulse');
                    }
                    
                    isPlaying = false;
                    statusEl.textContent = 'Твоя очередь!';
                }
                
                buttons.forEach((btn, index) => {
                    const newBtn = btn.cloneNode(true);
                    btn.parentNode.replaceChild(newBtn, btn);
                    
                    newBtn.addEventListener('click', () => {
                        if (isPlaying) return;
                        
                        newBtn.classList.add('active-pulse');
                        setTimeout(() => newBtn.classList.remove('active-pulse'), 300);
                        
                        playerSequence.push(parseInt(newBtn.dataset.index));
                        
                        if (playerSequence[playerSequence.length - 1] !== sequence[playerSequence.length - 1]) {
                            handleIncorrect(null);
                            playerSequence = [];
                            statusEl.textContent = 'Попробуй снова!';
                            setTimeout(() => playSequence(), 1000);
                        } else if (playerSequence.length === sequence.length) {
                            handleCorrect();
                        }
                    });
                });
                
                generateSequence();
                setTimeout(() => playSequence(), 500);
            }

            // УРОВЕНЬ 11 - Соедини пары
            function initLevel11() {
                const pairs = {
                    'bee': 'hive',
                    'bird': 'nest',
                    'squirrel': 'hollow'
                };
                
                let selectedAnimal = null;
                let matchedCount = 0;
                
                document.querySelectorAll('#level-11 .pair-item').forEach(item => {
                    item.classList.remove('selected', 'matched');
                    const newItem = item.cloneNode(true);
                    item.parentNode.replaceChild(newItem, item);
                    
                    newItem.addEventListener('click', () => {
                        if (newItem.classList.contains('matched')) return;
                        
                        if (newItem.dataset.type === 'animal') {
                            document.querySelectorAll('#level-11 .pair-item[data-type="animal"]').forEach(el => 
                                el.classList.remove('selected'));
                            newItem.classList.add('selected');
                            selectedAnimal = newItem.dataset.id;
                        } else if (newItem.dataset.type === 'home' && selectedAnimal) {
                            if (pairs[selectedAnimal] === newItem.dataset.id) {
                                const animalEl = document.querySelector(`#level-11 .pair-item[data-id="${selectedAnimal}"]`);
                                animalEl.classList.add('matched');
                                animalEl.classList.remove('selected');
                                newItem.classList.add('matched');
                                matchedCount++;
                                selectedAnimal = null;
                                
                                if (matchedCount === 3) {
                                    setTimeout(handleCorrect, 500);
                                }
                            } else {
                                handleIncorrect(newItem);
                            }
                        }
                    });
                });
            }

            // УРОВЕНЬ 12
            function initLevel12() {
                document.querySelectorAll('#level-12 .clickable').forEach(item => {
                    const newItem = item.cloneNode(true);
                    item.parentNode.replaceChild(newItem, item);
                    newItem.addEventListener('click', () => {
                        if (newItem.dataset.answer === '5') handleCorrect();
                        else handleIncorrect(newItem);
                    });
                });
            }

            // УРОВЕНЬ 13 - Поймай предметы
            function initLevel13() {
                const game = document.getElementById('catch-game');
                const basket = document.getElementById('basket');
                const countEl = document.getElementById('caught-count');
                let caughtCount = 0;
                let basketX = game.offsetWidth / 2 - 30;
                basket.style.left = basketX + 'px';
                
                game.addEventListener('mousemove', (e) => {
                    const rect = game.getBoundingClientRect();
                    basketX = e.clientX - rect.left - 30;
                    basketX = Math.max(0, Math.min(basketX, game.offsetWidth - 60));
                    basket.style.left = basketX + 'px';
                });
                
                game.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const rect = game.getBoundingClientRect();
                    const touch = e.touches[0];
                    basketX = touch.clientX - rect.left - 30;
                    basketX = Math.max(0, Math.min(basketX, game.offsetWidth - 60));
                    basket.style.left = basketX + 'px';
                });
                
                function dropItem() {
                    if (caughtCount >= 5) return;
                    
                    const item = document.createElement('div');
                    item.className = 'falling-item';
                    item.textContent = '🌰';
                    item.style.left = Math.random() * (game.offsetWidth - 50) + 'px';
                    item.style.top = '-50px';
                    game.appendChild(item);
                    
                    let top = -50;
                    const interval = setInterval(() => {
                        top += 5;
                        item.style.top = top + 'px';
                        
                        const itemRect = item.getBoundingClientRect();
                        const basketRect = basket.getBoundingClientRect();
                        
                        if (itemRect.bottom >= basketRect.top &&
                            itemRect.left < basketRect.right &&
                            itemRect.right > basketRect.left) {
                            clearInterval(interval);
                            item.remove();
                            caughtCount++;
                            countEl.textContent = caughtCount;
                            if (caughtCount === 5) {
                                setTimeout(handleCorrect, 500);
                            }
                        }
                        
                        if (top > game.offsetHeight) {
                            clearInterval(interval);
                            item.remove();
                        }
                    }, 50);
                }
                
                const dropInterval = setInterval(() => {
                    if (caughtCount >= 5) {
                        clearInterval(dropInterval);
                    } else {
                        dropItem();
                    }
                }, 1500);
            }

            // УРОВЕНЬ 14 - Рисование
            function initLevel14() {
                const canvas = document.getElementById('drawing-canvas');
                const ctx = canvas.getContext('2d');
                const clearBtn = document.getElementById('clear-canvas');
                const checkBtn = document.getElementById('check-drawing');
                let isDrawing = false;
                let currentColor = 'red';
                
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                document.querySelectorAll('.color-button').forEach(btn => {
                    const newBtn = btn.cloneNode(true);
                    btn.parentNode.replaceChild(newBtn, btn);
                    
                    newBtn.addEventListener('click', () => {
                        document.querySelectorAll('.color-button').forEach(b => b.classList.remove('selected'));
                        newBtn.classList.add('selected');
                        currentColor = newBtn.dataset.color;
                    });
                });
                
                function startDrawing(e) {
                    isDrawing = true;
                    draw(e);
                }
                
                function stopDrawing() {
                    isDrawing = false;
                    ctx.beginPath();
                }
                
                function draw(e) {
                    if (!isDrawing) return;
                    
                    const rect = canvas.getBoundingClientRect();
                    const x = (e.clientX || e.touches[0].clientX) - rect.left;
                    const y = (e.clientY || e.touches[0].clientY) - rect.top;
                    
                    ctx.lineWidth = 10;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = currentColor;
                    
                    ctx.lineTo(x, y);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                }
                
                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
                canvas.addEventListener('touchend', stopDrawing);
                canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
                
                clearBtn.addEventListener('click', () => {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                });
                
                checkBtn.addEventListener('click', () => {
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    let hasDrawing = false;
                    
                    for (let i = 0; i < imageData.data.length; i += 4) {
                        const r = imageData.data[i];
                        const g = imageData.data[i + 1];
                        const b = imageData.data[i + 2];
                        if (r < 250 || g < 250 || b < 250) {
                            hasDrawing = true;
                            break;
                        }
                    }
                    
                    if (hasDrawing) {
                        handleCorrect();
                    } else {
                        handleIncorrect(null);
                        messageArea.textContent = 'Нарисуй что-нибудь! 🎨';
                    }
                });
            }

            // УРОВЕНЬ 15 - Найди отличия
            function initLevel15() {
                const countEl = document.getElementById('differences-found');
                let foundCount = 0;
                
                document.querySelectorAll('.difference-spot').forEach(spot => {
                    spot.classList.remove('found');
                    const newSpot = spot.cloneNode(true);
                    spot.parentNode.replaceChild(newSpot, spot);
                    
                    newSpot.addEventListener('click', () => {
                        if (newSpot.classList.contains('found')) return;
                        
                        newSpot.classList.add('found');
                        foundCount++;
                        countEl.textContent = foundCount;
                        
                        if (foundCount === 3) {
                            setTimeout(handleCorrect, 500);
                        }
                    });
                });
            }

            startButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', startGame);
        });
    </script>

</body>
</html>     
